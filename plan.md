# easyK 개발 방법론 (Development Plan)

**문서 버전**: v1.0
**작성일**: 2025-12-31
**프로젝트**: easyK (외국인 맞춤형 정착 지원 플랫폼)

---

## 문서 목적

이 문서는 easyK 프로젝트의 **최상위 실행 규칙(Constitution)**입니다.

모든 개발 활동은 이 문서에 정의된 방법론을 따라야 하며,
`docs/` 폴더의 내용과 충돌할 경우 **이 문서의 규칙이 우선**합니다.

---

## 핵심 개발 방법론

### 1. TDD (Test-Driven Development)

**Kent Beck의 TDD 사이클을 엄격히 준수합니다:**

```
Red → Green → Refactor
```

#### Red (실패하는 테스트 작성)
- 기능 구현 전에 **반드시 실패하는 테스트**를 먼저 작성
- 테스트 이름은 행동을 명확히 표현
  - 예: `shouldCreateConsultationWithValidData`
- 테스트 실패 메시지는 명확하고 이해하기 쉬워야 함

#### Green (최소 코드로 테스트 통과)
- 테스트를 통과시키는 **최소한의 코드**만 작성
- 과도한 설계나 일반화는 하지 않음
- 하드코딩도 괜찮음 (리팩토링 단계에서 개선)

#### Refactor (구조 개선)
- 모든 테스트가 통과한 후에만 리팩토링 수행
- 중복 제거
- 명확성 향상
- 각 리팩토링 후 테스트 재실행

---

### 2. Tidy First (구조 우선 개선)

**모든 변경사항은 두 가지 유형으로 분류됩니다:**

#### STRUCTURAL (구조적 변경)
- 동작을 변경하지 않고 코드 구조만 개선
- 예시:
  - 변수/함수 이름 변경
  - 함수 추출 (Extract Method)
  - 코드 이동 (Move Code)
  - 파일 분리
- **반드시 테스트가 변경 전후 동일하게 통과해야 함**

#### BEHAVIORAL (행동적 변경)
- 실제 기능을 추가하거나 수정
- 예시:
  - 새로운 API 엔드포인트 추가
  - 비즈니스 로직 수정
  - 데이터베이스 스키마 변경

#### 핵심 규칙
1. **절대 구조적 변경과 행동적 변경을 같은 커밋에 섞지 않음**
2. 두 가지가 모두 필요하면 **구조적 변경을 먼저** 수행
3. 구조적 변경 전후로 테스트를 실행하여 동작이 변하지 않았음을 확인

---

### 3. 커밋 규율 (Commit Discipline)

**다음 조건을 모두 만족할 때만 커밋합니다:**

- [ ] 모든 테스트가 통과
- [ ] 컴파일러/린터 경고 없음
- [ ] 하나의 논리적 작업 단위만 포함
- [ ] 커밋 메시지에 STRUCTURAL 또는 BEHAVIORAL 명시
- [ ] 작고 빈번한 커밋 선호 (큰 커밋보다)

#### 커밋 메시지 형식

```
<type>(<scope>): <subject>

[STRUCTURAL|BEHAVIORAL]

<body>
```

**예시:**

```
refactor(consultations): extract matching logic to service

[STRUCTURAL]

- Extract consultant matching logic from router to matching_service.py
- No behavior change, all tests pass
```

```
feat(consultations): add consultation request API

[BEHAVIORAL]

- Implement POST /api/consultations endpoint
- Add Pydantic schema validation
- Integrate with consultant matching service
- Add unit tests for consultation creation

Closes #123
```

---

## 개발 워크플로우

### 새로운 기능 개발 시

1. **실패하는 테스트 작성** (Red)
   - 기능의 아주 작은 부분에 대한 테스트
   - 명확한 테스트 이름과 실패 메시지

2. **최소 코드 작성** (Green)
   - 테스트를 통과시키는 최소한의 코드만

3. **테스트 실행** → Green 확인

4. **필요시 구조 개선** (Tidy First)
   - 구조적 변경만 수행
   - 각 변경 후 테스트 재실행
   - 구조적 변경은 별도 커밋

5. **다음 기능으로 이동**
   - 행동적 변경과 구조적 변경 커밋 분리

6. **기능 완료까지 반복**

---

## 코드 품질 기준

### 1. 중복 제거
- 코드 중복을 **무자비하게 제거**
- DRY (Don't Repeat Yourself) 원칙
- 3번 이상 반복되면 함수/컴포넌트로 추출

### 2. 명확한 의도 표현
- 변수/함수 이름으로 의도를 명확히 전달
- 주석보다 코드 자체가 설명적이어야 함
- 복잡한 로직은 작은 함수로 분리

### 3. 명시적 의존성
- 숨겨진 의존성 금지
- 함수 파라미터로 의존성 전달
- 전역 변수 최소화

### 4. 단일 책임
- 메서드/함수는 한 가지 일만 수행
- 클래스/모듈은 하나의 책임만
- 작은 단위 선호

### 5. 상태와 부작용 최소화
- 순수 함수 선호
- 상태 변경은 명시적으로
- 불변성 유지

### 6. 가장 단순한 해결책
- YAGNI (You Aren't Gonna Need It)
- 현재 필요한 가장 단순한 방법 사용
- 미래를 위한 과도한 설계 금지

---

## 리팩토링 가이드라인

### 리팩토링 시점
- **Green 상태에서만** (모든 테스트 통과)
- 새 기능 추가 전
- 코드 리뷰 피드백 반영 시

### 리팩토링 방법
1. **검증된 리팩토링 패턴 사용**
   - Extract Method
   - Rename Variable
   - Move Method
   - Extract Class
   - Inline Method

2. **한 번에 하나씩**
   - 여러 리팩토링을 동시에 하지 않음
   - 각 단계마다 테스트 실행

3. **우선순위**
   - 중복 제거
   - 가독성 향상
   - 성능 개선 (필요시)

---

## 테스트 작성 규칙

### 테스트 구조
```
describe('기능명', () => {
  it('should [예상 동작] when [조건]', () => {
    // Arrange (준비)
    const input = ...

    // Act (실행)
    const result = functionUnderTest(input)

    // Assert (검증)
    expect(result).toBe(expected)
  })
})
```

### 테스트 원칙
- **하나의 테스트는 하나의 동작만 검증**
- 테스트 이름이 명세서 역할
- 독립적이고 반복 가능
- 빠르게 실행 (느린 테스트는 별도 분리)

### 테스트 범위
- 단위 테스트: 개별 함수/메서드
- 통합 테스트: API 엔드포인트
- E2E 테스트: 주요 사용자 흐름 (선택적)

---

## 버그 수정 시

1. **API 레벨에서 실패하는 테스트 작성**
   - 버그를 재현하는 테스트

2. **더 작은 테스트 추가**
   - 문제를 정확히 재현하는 최소 테스트

3. **두 테스트 모두 통과하도록 수정**

4. **리팩토링 (필요시)**

---

## Task 완료 및 중지 규칙

### Task 완료 시 수행 작업

1. **tasks.md 업데이트**
   - Task 상태를 DONE으로 변경
   - 변경 사항 명확히 기록

2. **즉시 작업 중지**
   - 다음 Task로 자동 진행하지 않음
   - 사용자의 다음 `"go"` 입력 대기

### 왜 중지하는가?
- 각 Task 완료 후 검토 기회 제공
- 방향성 재확인
- 예상치 못한 문제 조기 발견

---

## 테스트 실행 전략

### 기본 원칙
- **매번 모든 테스트 실행** (긴 테스트 제외)
- 빠른 피드백 루프 유지
- CI/CD에서 자동 실행

### 테스트 분류
1. **빠른 테스트** (단위 테스트)
   - 매 변경마다 실행
   - < 1초 이내

2. **중간 테스트** (통합 테스트)
   - 커밋 전 실행
   - < 10초 이내

3. **긴 테스트** (E2E, 성능)
   - PR 전 또는 CI에서만 실행
   - 개발 중에는 선택적

---

## 협업 원칙

### AI 에이전트와 협업
1. **사전 검증**
   - 서브 에이전트로 계획 검증
   - 복잡한 작업은 여러 에이전트 활용

2. **명확한 컨텍스트 제공**
   - 관련 문서 참조
   - 기존 코드 패턴 제시
   - 의도와 제약 사항 명시

3. **단계별 진행**
   - 큰 작업은 작은 Task로 분리
   - 각 단계마다 검증

### 인간 개발자와 협업
1. **코드 리뷰**
   - 모든 코드는 리뷰 필수
   - 건설적이고 구체적인 피드백

2. **페어 프로그래밍**
   - 복잡한 기능은 페어로 진행
   - TDD 사이클 함께 수행

3. **지식 공유**
   - 문서 업데이트
   - 학습 내용 공유

---

## 최종 원칙

### "먼저 이해하고, 계획하고, 검증하라"

1. **문서를 먼저 읽고 이해**
   - `/docs` 폴더의 모든 문서
   - 도메인 지식, 요구사항, 제약 파악

2. **계획을 문서로 작성**
   - `tasks.md`로 실행 가능한 Task 정의
   - 각 Task는 테스트 가능한 최소 단위

3. **서브 에이전트로 사전 검증**
   - 복잡한 작업은 계획 단계에서 검증
   - 기술적 실현 가능성 확인

4. **한 번에 하나의 테스트만**
   - 작은 단위로 진행
   - 빠른 피드백

5. **테스트를 통과시키고**
   - Green 상태 유지
   - 항상 동작하는 코드

6. **그 다음 구조를 개선**
   - 리팩토링은 Green 상태에서만
   - 구조적 변경과 행동적 변경 분리

7. **매번 모든 테스트 실행**
   - 회귀 방지
   - 긴 테스트는 제외 가능

---

## 문서 우선순위

충돌 시 우선순위:

1. **plan.md** (이 문서) - 방법론과 원칙
2. **tasks.md** - 실행 계획
3. **/docs** 폴더 문서 - 제품 요구사항과 설계

---

**이 문서는 easyK 프로젝트의 헌법입니다.**
**모든 개발 활동은 이 원칙을 따라야 합니다.**
