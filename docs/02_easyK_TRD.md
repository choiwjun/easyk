# easyK TRD (기술 요구사항 정의서)

**문서 버전**: v1.0  
**작성일**: 2025-12-30  
**프로젝트**: easyK (외국인 맞춤형 정착 지원 플랫폼)  
**대상 독자**: 개발팀, 인프라팀, 보안팀

---

## 1. 시스템 아키텍처 개요

### 전체 시스템 구조

```
┌─────────────────────────────────────────────────────────────┐
│                     사용자 인터페이스 (Frontend)             │
│              React + i18n (한국어/영어 지원)               │
│                    (Vercel에서 배포)                         │
└────────────────────────────┬────────────────────────────────┘
                             │ (HTTPS API 호출)
                             ▼
┌─────────────────────────────────────────────────────────────┐
│                   API 계층 (Backend)                         │
│            Python (FastAPI 또는 Django REST)                │
│              (Railway 또는 Render에서 호스팅)               │
│                                                              │
│  ├─ 회원 관리 API (가입, 로그인, 프로필)                    │
│  ├─ 상담 신청/예약 API (FEAT-1)                            │
│  ├─ 일자리 관리 API (FEAT-2)                               │
│  ├─ 정부 지원 정보 API (FEAT-3)                            │
│  ├─ 결제 API (토스/포트원 연동)                             │
│  └─ 분석 API (대시보드, 통계)                              │
└────────────────────────────┬────────────────────────────────┘
                             │
          ┌──────────────────┼──────────────────┐
          ▼                  ▼                  ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│   데이터베이스  │  │  외부 서비스    │  │  파일 저장소    │
│   (Supabase)    │  │  (결제, 인증)   │  │  (Supabase      │
│   PostgreSQL    │  │                 │  │   Storage)      │
│                 │  │ ├─ 토스페이먼츠 │  │                 │
│ ├─ Users        │  │ ├─ 포트원       │  │ ├─ 프로필 이미지│
│ ├─ Consultations│  │ ├─ 카카오 로그인│  │ └─ 첨부 파일    │
│ ├─ Jobs         │  │ └─ 구글 로그인  │  │                 │
│ ├─ Supports     │  │                 │  │                 │
│ ├─ Reviews      │  └─────────────────┘  └─────────────────┘
│ └─ Transactions │
└─────────────────┘

          ▼ (선택사항)
┌─────────────────────────────────────────────────────────────┐
│                모니터링 & 분석 (선택사항)                   │
│       Google Analytics / Sentry / LogRocket               │
└─────────────────────────────────────────────────────────────┘
```

### 데이터 흐름 예시 (상담 신청)
1. 외국인 사용자가 React UI에서 상담 신청 폼 작성
2. Frontend → Backend API로 데이터 전송
3. Backend: 데이터 검증 → DB 저장 → 매칭 로직 실행
4. DB에서 적합한 전문가 조회
5. 알림 발송 (이메일/푸시)
6. Frontend: 신청 완료 화면 표시 및 예약 대기 안내

---

## 2. 권장 기술 스택

### 2.1 프론트엔드 (Frontend)

**선택 기술: React (+ Next.js 고려)**

| 항목 | 선택 | 이유 |
|------|------|------|
| **프레임워크** | React 18+ | AI 코딩 도구 학습도 높음, 빠른 개발 |
| **라우팅** | React Router v6 | 단순 SPA 구조에 적합 |
| **상태 관리** | Redux Toolkit 또는 Zustand | 사용자 인증, 폼 상태 관리 |
| **UI 컴포넌트** | Material-UI 또는 Shadcn/ui | 전문적인 외형, 빠른 개발 |
| **HTTP 클라이언트** | Axios 또는 Fetch API | Backend API 호출 |
| **다국어 지원** | i18n-js (react-i18next) | 한국어/영어 쉬운 전환 |
| **폼 관리** | React Hook Form | 가벼움, 유효성 검사 |
| **배포** | Vercel | Next.js 최적화, CDN 빠름 |

**대안 (과도 복잡)**:
- Vue.js: React보다 학습곡선 완만하지만, AI 도구 학습도 낮음
- Angular: 엔터프라이즈용, 초기 프로젝트로는 과도

**벤더 락인 리스크**: 낮음 (React는 커뮤니티 기반, 배포처 변경 가능)

---

### 2.2 백엔드 (Backend)

**선택 기술: Python + FastAPI**

| 항목 | 선택 | 이유 |
|------|------|------|
| **언어** | Python 3.11+ | 배우기 쉬움, AI 코딩 성능 높음, 빠른 개발 |
| **프레임워크** | FastAPI | 비동기 지원, 자동 API 문서 생성, 빠른 성능 |
| **대안** | Django + DRF | 더 성숙한 생태계, 더 무거움 |
| **ORM** | SQLAlchemy (비동기: asyncpg) | 쿼리 작성 간결, DB 유연성 |
| **검증** | Pydantic | 요청/응답 자동 검증 |
| **인증** | JWT (PyJWT) | 상태 비저장, 확장성 |
| **작업 스케줄링** | Celery + Redis (선택) | 비동기 작업 (이메일 발송, 배치) |
| **호스팅** | Railway 또는 Render | 간단한 배포, 자동 스케일링 |

**대안**:
- Node.js (Express): 동일 수준의 성능, 프론트엔드와 동일 언어 (복잡도 증가)
- Go: 매우 빠름, 초기 학습곡선 높음

**벤더 락인 리스크**: 낮음 (표준 Python, 호스팅 이동 가능)

---

### 2.3 데이터베이스 (Database)

**선택 기술: Supabase (PostgreSQL + Firebase 대체)**

| 항목 | 선택 | 이유 |
|------|------|------|
| **DB 엔진** | PostgreSQL | 관계형 쿼리, 확장성, 무료 오픈소스 |
| **호스팅 방식** | Supabase | 관리형 서비스, 자동 백업, REST API 자동 생성 |
| **대안** | Firebase (NoSQL) | 실시간 동기화, 더 빠른 시작 (유연성 낮음) |
| **가격** | 무료 티어 충분 (파일럿 단계) | 월 50GB 스토리지, 500MB/월 대역폭 |
| **확장 후 비용** | 월 $25~100 | 사용량 기반 요금 |

**데이터 구조 (관계형)**:
- Users (외국인, 전문가, 관리자)
- Consultations (상담 신청)
- Consultants (전문가 정보)
- Jobs (일자리 공고)
- Government Supports (정부 지원)
- Reviews (평가)
- Payments (결제 기록)

**벤더 락인 리스크**: 중간 (PostgreSQL은 표준이지만, Supabase의 특화 기능에 의존할 수 있음)
**완화 방안**: 표준 SQL 사용, 정기 데이터 덤프/백업

---

### 2.4 배포 & 호스팅 (Deployment)

| 구성요소 | 선택 | 비용 (월) | 특징 |
|---------|------|----------|------|
| **프론트엔드** | Vercel | 무료 (기본) | Next.js 최적화, 자동 배포, CDN |
| **백엔드** | Railway | $5~50 | Python 쉬운 배포, 자동 스케일링 |
| **DB** | Supabase | 무료 (파일럿) | 관리형 PostgreSQL, 자동 백업 |
| **파일 저장** | Supabase Storage | 무료 (1GB) | 프로필 이미지, 문서 보관 |
| **DNS** | Vercel (기본) | 무료 | 커스텀 도메인 |

**초기 예상 비용**: 월 $5~10 (프리 티어 활용)  
**확장 후 예상 비용**: 월 $50~200

---

### 2.5 외부 서비스 연동

| 서비스 | 목적 | 선택 | 대체 옵션 |
|--------|------|------|----------|
| **결제** | 상담료 결제 | 토스페이먼츠 | 포트원 (구 PG사) |
| **인증** | 소셜 로그인 | 카카오 + 구글 | 네이버, 깃허브 |
| **이메일** | 상담 확인, 알림 | SendGrid 또는 Mailgun | AWS SES, Postmark |
| **SMS** (선택) | 상담 예약 알림 | Twilio 또는 NHN Coolsms | Amazon SNS |
| **분석** (선택) | 사용자 행동 분석 | Google Analytics 4 | Mixpanel, Amplitude |
| **모니터링** | 에러 추적 | Sentry | Rollbar, LogRocket |

---

## 3. 비기능적 요구사항 (Non-Functional Requirements)

### 3.1 성능 (Performance)
- **페이지 로드 시간**: < 2초 (첫 콘텐츠풀 페인트, FCP)
- **API 응답 시간**: < 500ms (P95 기준)
- **동시 접속 처리**: 초기 50명, 확장 500명 (Vercel/Railway 자동 스케일)
- **DB 쿼리**: 인덱싱으로 < 100ms 유지

**구현 방안**:
- React 코드 분할 (Code Splitting)
- 이미지 최적화 (WebP, CDN)
- DB 쿼리 최적화 (SELECT 최소화, JOIN 효율화)
- 캐싱 전략 (브라우저 캐시, Redis 캐시)

### 3.2 보안 (Security)
- **HTTPS**: 모든 통신 암호화 (Vercel/Railway 기본)
- **인증**: JWT 토큰 (HTTP-only 쿠키)
- **권한**: 역할 기반 접근 제어 (RBAC: 외국인/전문가/관리자)
- **입력 검증**: 백엔드에서 Pydantic 자동 검증
- **SQL Injection 방지**: ORM 사용 (SQLAlchemy)
- **CORS**: 신뢰할 수 있는 도메인만 허용
- **Rate Limiting**: API 남용 방지 (분당 요청 제한)
- **개인정보 보호**: 민감 데이터 암호화 (비밀번호 해싱: bcrypt)

**보안 체크리스트**:
- [ ] OWASP Top 10 검토 (SQL Injection, XSS, CSRF 등)
- [ ] 환경 변수 관리 (API 키, DB 비밀번호는 코드에 미포함)
- [ ] 데이터 백업 (주 1회 자동)
- [ ] 접근 로그 모니터링 (의심 활동 알림)

### 3.3 확장성 (Scalability)
- **수평 확장**: Vercel (프론트엔드), Railway (백엔드) 자동 스케일
- **DB**: PostgreSQL 읽기 복제본 (향후 추가)
- **캐싱**: Redis 도입 (월 활성 사용자 1000명 이상 시)
- **CDN**: Vercel의 글로벌 CDN 활용

### 3.4 가용성 (Availability)
- **목표 가동 시간**: 99.5% (월 3.6시간 다운타임 허용)
- **자동 복구**: 헬스체크 및 자동 재시작
- **장애 대응**: 모니터링 알림 (Sentry)

### 3.5 데이터 보관 (Data Retention)
- **거래 기록**: 5년 보관 (세무 요구사항)
- **사용자 로그**: 1년 보관 (분석용)
- **삭제 요청**: 30일 내 완전 삭제 (GDPR/개인정보보호법)
- **익명화**: 마케팅 분석용 데이터는 식별자 제거

---

## 4. 데이터베이스 요구사항

### 4.1 주요 엔티티 (Entities)

**Users (사용자)**
- ID, Email, Password (해싱), Role (외국인/전문가/관리자)
- 국적, 비자 종류, 선호 언어, 거주 지역
- 프로필 이미지 URL, 자기소개
- Created_at, Updated_at

**Consultants (법률 전문가)**
- ID, User_ID (FK)
- 사무소명, 보유 자격, 전문 분야 (비자/근로/계약/소송)
- 평점, 후기 수
- 시간당 요금, 가용 시간대
- Created_at

**Consultations (상담 신청)**
- ID, User_ID (외국인), Consultant_ID (전문가)
- 상담 유형 (비자/근로/계약 등)
- 상담 내용, 상담 상태 (신청/매칭/예약/진행/완료)
- 예약된 날짜/시간, 상담 방식 (이메일/화상통화)
- 결제 상태 (대기/완료/환불)
- Created_at, Scheduled_at, Completed_at

**Payments (결제)**
- ID, Consultation_ID (FK)
- 금액, 수수료, 순수익
- 결제 상태 (대기/완료/실패), 결제 방식 (토스/포트원)
- Created_at

**Reviews (평가)**
- ID, Consultation_ID (FK), User_ID (평가자)
- 평점 (1~5), 리뷰 텍스트
- Created_at

**Jobs (일자리)**
- ID, Posted_by (지자체 담당자 ID)
- 직종, 회사명, 급여, 근무 지역
- 자격 요건, 우대사항, 고용형태 (정규/계약/일당)
- 상태 (모집중/종료), 마감일
- Created_at, Updated_at

**Job_Applications (지원)**
- ID, Job_ID (FK), User_ID (외국인)
- 상태 (신청/진행중/채용/거절)
- Applied_at, Updated_at

**Government_Supports (정부 지원)**
- ID, 지원명, 카테고리 (장려금/교육/훈련)
- 설명, 대상 조건, 지원 내용
- 기관 (고용노동부/중소벤처기업부), 공식 링크
- Created_at, Updated_at

---

### 4.2 인덱싱 전략

**성능 최적화를 위한 인덱싱**:
- `Users.email` (고유 인덱스): 로그인 빠름
- `Consultations.user_id`, `consultant_id`: 빠른 조회
- `Consultations.status`: 상태별 필터링 빠름
- `Jobs.posted_by, status`: 지자체 공고 조회
- `Reviews.consultant_id`: 전문가 평점 계산

---

## 5. 접근제어 & 권한 모델 (Access Control)

### 5.1 역할 정의 (Roles)

| 역할 | 접근 권한 |
|------|----------|
| **외국인 (User)** | 프로필 조회/수정, 상담 신청, 결제, 후기 작성, 일자리 지원 |
| **전문가 (Consultant)** | 프로필 조회/수정, 상담 요청 수락/거절, 평가 조회 |
| **지자체 (Admin)** | 일자리 공고 관리, 통계 조회, 사용자 관리 |
| **슈퍼 관리자 (Superadmin)** | 모든 권한, 시스템 설정, 정부 지원 정보 관리 |

### 5.2 권한 정책 (Authorization)

```
외국인:
  ✓ 자신의 프로필 조회/수정
  ✓ 상담 신청 (자신의 정보 기반)
  ✓ 자신의 상담 조회
  ✗ 다른 사용자의 정보 접근
  ✗ 전문가 추가/삭제

전문가:
  ✓ 자신의 프로필 조회/수정
  ✓ 자신에게 들어온 상담 요청 조회
  ✓ 상담 수락/거절
  ✗ 다른 전문가의 정보 수정
  ✗ 사용자 정보 조회 (상담 내용 범위 내)

지자체:
  ✓ 일자리 공고 작성/수정/삭제
  ✓ 공고별 지원자 조회
  ✓ 통계 대시보드 (익명화된 데이터)
  ✗ 사용자 개인정보 다운로드 (통계만)
  ✗ 상담 내용 조회 (별도 협의)
```

---

## 6. 데이터 생명주기 & 개인정보 보호

### 6.1 데이터 수집 원칙
- **최소화**: 필요한 정보만 수집 (선택 필드 최대한 활용)
- **투명성**: 가입 시 개인정보 처리방침 명확 안내
- **동의**: 마케팅용 데이터 수집은 명시적 동의 필요

### 6.2 데이터 보존 기간

| 데이터 | 보존 기간 | 이유 |
|--------|----------|------|
| 거래 기록 (결제, 상담) | 5년 | 세무/법률 요구사항 |
| 사용자 프로필 | 활성 기간 + 1년 | 이용자 복귀 대비 |
| 상담 기록 | 3년 | 법적 분쟁 대비 |
| 접근 로그 | 1년 | 보안 감시 |
| 마케팅 분석용 | 1년 | 지표 추적 |

### 6.3 삭제 & 익명화 경로

**사용자가 탈퇴 요청 시**:
1. 사용자 정보 즉시 삭제 (30일 내)
2. 거래 기록은 식별자 제거 후 익명화 보존
3. 상담 기록은 마스킹 처리 (이름, 이메일 제거)

**개인정보 유출 시 대응**:
- 즉시 알림 (해당 사용자)
- 법집행기관 신고 (필요시)
- 사후 조치 및 개선책 공지

---

## 7. 기술 선택의 리스크 & 완화 전략

### 7.1 벤더 락인 (Vendor Lock-in) 리스크

| 선택 | 리스크 | 완화 방안 |
|------|--------|----------|
| Supabase PostgreSQL | 대안: AWS RDS, Google Cloud SQL로 이동 가능 | 표준 SQL 사용, 정기 데이터 내보내기 |
| Vercel 배포 | 대안: Netlify, AWS Amplify로 이동 가능 | 표준 Next.js/React 사용 |
| 토스페이먼츠 | 대안: 포트원 기술로 쉽게 변경 가능 | 결제 추상화 레이어 구현 |

### 7.2 데이터 이동 전략

**정기 백업 & 내보내기**:
- 주 1회: Supabase 자동 백업 (Supabase 내장)
- 월 1회: CSV/JSON 형식으로 클라우드 저장소 (Google Drive 등) 내보내기
- 분기 1회: 로컬 저장소에 아카이브

---

## 8. 배포 파이프라인 (CI/CD)

### 8.1 개발 → 프로덕션 흐름

```
로컬 개발 → GitHub 푸시
     ↓
GitHub Actions (테스트 자동 실행)
     ↓
테스트 통과 → 스테이징 배포
     ↓
수동 검증 (QA)
     ↓
프로덕션 배포 (Vercel/Railway 자동)
```

### 8.2 배포 환경

| 환경 | 목적 | URL | 자동 배포 |
|------|------|-----|----------|
| **개발 (Development)** | 기능 개발 | localhost:3000 | 수동 (로컬) |
| **스테이징** | 통합 테스트 | staging.easyk.com | main 브랜치에 자동 |
| **프로덕션** | 실제 서비스 | easyk.com | 태그(v1.0.1) 기반 수동 |

---

## 9. 모니터링 & 로깅

### 9.1 모니터링 항목

- **프론트엔드**: 페이지 로드 시간, 에러율, 사용자 세션 (Google Analytics)
- **백엔드**: API 응답 시간, 에러 로그, DB 쿼리 성능 (Sentry)
- **인프라**: CPU, 메모리, 디스크 사용률 (Railway 내장)

### 9.2 알림 설정

- API 에러율 > 1% → Slack 알림
- DB 쿼리 응답 > 1초 → 로그 기록
- 배포 실패 → 메일 알림

---

## 10. 초기 구현 우선순위

### Phase 1 (MVP: 4-5주)
1. ✅ 사용자 인증 (회원가입/로그인)
2. ✅ 기본 프로필 관리
3. ✅ 상담 신청/예약 시스템
4. ✅ 기초 결제 통합 (토스)
5. ✅ 일자리 게시판 (기본)
6. ✅ 정부 지원 정보 (정적 데이터)
7. ✅ 한국어/영어 다국어 지원

### Phase 2 (Stabilize: 2-3주)
1. ✅ 성능 최적화 (DB 인덱싱, CDN)
2. ✅ 보안 강화 (권한 검증, 레이트 리미팅)
3. ✅ 분석 및 모니터링 구축
4. ✅ 버그 수정 및 UX 개선

### Phase 3 (확장: 3개월+)
1. 🔄 AI 매칭 고도화
2. 🔄 추가 지자체 계약
3. 🔄 다국어 확대 (중국어, 베트남어)
4. 🔄 커뮤니티 기능

---

**문서 관리**  
- 최종 검토: 개발팀, 인프라팀
- 버전 관리: 분기 검토 및 업데이트
- 변경 이력: 기술 선택 변경 시 Decision Log 기록
